function Envi(t,s){this.canvas=new Canvas(t),this.keyboard=new Keyboard(s),this.scroll=new Scroll(s),this.width=this.canvas.width,this.height=this.canvas.height,this.depth=(this.canvas.width+this.canvas.height)/1.5,this.shiftX=1,this.shiftY=1,this.font="sans-serif",this.fontMax=25,this.fontStyle="",this.frame=[this.width,this.height,this.depth],this.printStyle="fill",this.resolutionFactor=16,this.shapes=new Shapes,this.models=new Models}function Scene(t,s){void 0===s&&(s=[]),this.envi=t,this.assets=s}Envi.prototype.pointTo3D=function(t){var s=t[0]+t[2]/this.depth*(this.width*this.shiftX/2-t[0]),i=t[1]+t[2]/this.depth*(this.height*this.shiftY/2-t[1]);return[s,i]},Envi.prototype.doModelAnimation=function(t,s){for(var i=0;i<s.modelAttributes.length;i+=1)t=s.modelAttributes[i].processPoint(this.frame,t,s);return t},Envi.prototype.charToSize=function(t){if(t<this.depth){var s=this.fontMax*((this.depth-t)/this.depth),i=Math.round(s).toString()+"px ";return[this.fontStyle+i+this.font]}return[this.fontStyle+"0px"+this.font]},Scene.prototype.add=function(t){typeof t===Array?this.assets=this.assets+t:this.assets[this.assets.length]=t},Scene.prototype.play=function(){this.envi.keyCheck(),this.envi.scrollCheck(),this.envi.canvas.ctx.clearRect(0,0,canvas.width,canvas.height);for(var t=0;t<this.assets.length;t+=1)this.assets[t].draw(this.envi)};
function Frame(t,s,e){this.width=width,this.height=s,this.depth=e}function explode_infinite(t,s,e,i,h){void 0===i&&(i=1),void 0===h&&(h=0),this.side=t,this.distance=s,this.scale=e,this.speed=i/100}function rotateY(t,s){void 0===s&&(s=1),this.side=t,this.speed=s,this.state=0}function planeXTransform(t,s,e,i){void 0===e&&(e=1),void 0===i&&(i=0),this.distance=t,this.scale=s,this.speed=e,this.state=i}function planeWave(t,s,e){this.state=1,this.speed=t,this.width=s,this.depth=e}function house_fly(t,s,e){void 0===e&&(e=!1),this.speed=t,this.range=s,this.slave=e,this.direction=[1,1,1]}explode_infinite.prototype.processPoint=function(t,s,e){for(var i=0;i<s.length-1;i+=1)s[i]>this.side*e.scale/2?s[i]=s[i]+this.scale*this.state:s[i]==this.side*e.scale/2||(s[i]=s[i]-this.scale*this.state);return 1e7>this.state?this.state+=1*this.speed:this.state=0,s},rotateY.prototype.processPoint=function(t,s,e){var i=this.side/2*e.scale,h=Math.abs(i-s[0])/i,o=Math.abs(i-s[3])/i,a=h*this.side*(this.state/1e3);s[0]=s[0]*a*e.scale;var n=o*this.side*(this.state/1e3);return s[2]=s[2]*n*e.scale,1e3>this.state?this.state+=1*this.speed:(console.log("point[0]; "+s[0]),console.log("deltaX: "+h),console.log("rotX: "+a),this.state=0),s},planeWave.prototype.processPoint=function(t,s,e){return s[0]==this.state?s[2]=s[2]+this.depth:(s[1]==this.state||s[-1]==this.state)&&(s[2]=s[2]+this.depth/2),e.width>this.state?this.state+=1*this.speed:this.state=1,s},planeWave.prototype.processGeo=function(t){for(var s=this.state/t.scale,e=[],i=0;i<t.geo.length;i+=1){var h=t.geo[i];h[0]==s?h[2]=h[2]+this.depth:(h[1]==s||h[-1]==s)&&(h[2]=h[2]+this.depth/2),e[e.length]=[h]}return t.width>s?this.state+=1*this.speed:this.state=1,e},house_fly.prototype.processPoint=function(t,s){if(0==this.slave)for(var e=0;e<t.pos.length;e+=1){var i=Math.abs(s[e]/2-t.pos[e]);i<s[e]/2*Math.max(.4,Math.random())?t.pos[e]=t.pos[e]+Math.random()*this.speed*this.direction[e]:this.direction[e]=-1*this.direction[e]}};
function Asset(t,s,i,o,e){void 0===t&&(t=[]),void 0===s&&(s=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===e&&(e=1),this.geo=t,this.xpos=s,this.ypos=i,this.zpos=o,this.pos=[this.xpos,this.ypos,this.zpos],this.scale=e,this.modelAttributes=[],this.sceneAttributes=[],this.width=void 0,this.height=void 0}Asset.prototype.draw=function(t){this.doSceneAnimation(t.frame);var s=[];for(i=0;i<this.geo.length;i+=1){s=this.setModelScale(this.geo[i]),s=t.doModelAnimation(s,this),s=this.moveToScenePos(s);var o=t.pointTo3D(s),e=[s[3],t.charToSize(s[2])];t.canvas.ctx.font=e[1],t.canvas.ctx.fillStyle=this.geo[i][4],t.canvas.ctx.fillText(e[0],o[0],o[1])}},Asset.prototype.setModelScale=function(t){return[t[0]*this.scale,t[1]*this.scale,t[2]*this.scale,t[3]]},Asset.prototype.moveToScenePos=function(t){return[this.pos[0]+t[0],this.pos[1]+t[1],this.pos[2]+t[2],t[3],t[4]]},Asset.prototype.doSceneAnimation=function(t){for(var s=0;s<this.sceneAttributes.length;s+=1)this.sceneAttributes[s].processPoint(this,t)};
function ImageGrid(t,i){this.envi=t,this.img=null,this.grid={},this.sourceFile=i,this.data=this.makeData(),this.geo=this.makeGeo(),this.asset}ImageGrid.prototype.toAsset=function(t,e,s,h){this.xpos=t,this.ypos=e,this.zpos=s,this.pos=[t,e,s],this.scale=h,this.modelAttributes=[],this.sceneAttributes=[],this.width=this.img.width,this.height=this.img.height;var o,n;for(i=0;i<this.geo.length;i+=1)o=this.geo[i],n=[o[0]*this.scale,o[1]*this.scale,o[2]*this.scale,o[3]],n=[this.xpos+n[0],this.ypos+n[1],this.zpos+n[2],o[3],o[4]],this.geo[i]=n;this.draw=function(){for(var t=[],e=0;e<this.modelAttributes.length;e+=1)t=this.modelAttributes[e].processGeo(this);for(i=0;i<t.length;i+=1){var s=t[i],h=this.envi.pointTo3D(s),o=[s[3],this.envi.charToSize(s[2])];this.envi.canvas.ctx.font=o[1],this.envi.canvas.ctx.fillStyle=s[4],this.envi.canvas.ctx.fillText(o[0],h[0],h[1])}}},ImageGrid.prototype.makeData=function(){this.img=new Image,this.img.src=this.sourceFile,this.grid.width=this.img.width/this.envi.resolutionFactor,this.grid.height=this.img.height/this.envi.resolutionFactor,envi.dummyContext.width=this.img.width,envi.dummyContext.height=this.img.height,envi.dummyContext.drawImage(this.img,0,0);for(var t=[],i=1;i<this.grid.width;i+=1)for(var e=1;e<this.grid.height;e+=1)t[i*e]=envi.dummyContext.getImageData(i*this.envi.resolutionFactor,e*this.envi.resolutionFactor,1,1).data;return t},ImageGrid.prototype.makeGeo=function(t){"undefined"==typeof t&&(t="o");for(var i=[],e=1;e<this.grid.width;e+=1)for(var s=1;s<this.grid.height;s+=1)i[i.length]=[e,s,1,t,this.rgbToHex(this.data[e*s])];return i},ImageGrid.prototype.rgbToHex=function(t){return"#"+this.componentToHex(t[0])+this.componentToHex(t[1])+this.componentToHex(t[2])},ImageGrid.prototype.componentToHex=function(t){var i=t.toString(16);return 1==i.length?"0"+i:i};
function Models(){this.box=[[0,0,0,"0"],[5,0,0,"0"],[5,5,0,"0"],[0,5,0,"0"],[0,0,5,"0"],[5,0,5,"0"],[5,5,5,"0"],[0,5,5,"0"]],this.container=[[0,0,100,"&","#fdfdfd"],[canvas.width,0,100,"&","#fdfdfd"],[0,canvas.height,100,"&","#fdfdfd"],[canvas.width,canvas.height,100,"&","#fdfdfd"],[0,0,300,"&","#fdfdfd"],[canvas.width,0,300,"&","#fdfdfd"],[0,canvas.height,300,"&","#fdfdfd"],[canvas.width,canvas.height,300,"&","#fdfdfd"],[0,0,500,"&","#fdfdfd"],[canvas.width,0,500,"&","#fdfdfd"],[0,canvas.height,500,"&","#fdfdfd"],[canvas.width,canvas.height,500,"&","#fdfdfd"],[0,0,700,"&","#fdfdfd"],[canvas.width,0,700,"&","#fdfdfd"],[0,canvas.height,700,"&","#fdfdfd"],[canvas.width,canvas.height,700,"&","#fdfdfd"],[0,0,900,"&","#fdfdfd"],[canvas.width,0,900,"&","#fdfdfd"],[0,canvas.height,900,"&","#fdfdfd"],[canvas.width,canvas.height,900,"&","#fdfdfd"],[0,0,1100,"&","#fdfdfd"],[canvas.width,0,1100,"&","#fdfdfd"],[0,canvas.height,1100,"&","#fdfdfd"],[canvas.width,canvas.height,1100,"&","#fdfdfd"],[0,0,1300,"&","#fdfdfd"],[canvas.width,0,1300,"&","#fdfdfd"],[0,canvas.height,1300,"&","#fdfdfd"],[canvas.width,canvas.height,1300,"&","#fdfdfd"],[0,0,1500,"&","#fdfdfd"],[canvas.width,0,1500,"&","#fdfdfd"],[0,canvas.height,1500,"&","#fdfdfd"],[canvas.width,canvas.height,1500,"&","#fdfdfd"],[0,0,1700,"&","#fdfdfd"],[canvas.width,0,1700,"&","#fdfdfd"],[0,canvas.height,1700,"&","#fdfdfd"],[canvas.width,canvas.height,1700,"&","#fdfdfd"]],this.grid2D=function(d,f,C){"undefined"==typeof C&&(C=".");for(var F=[],a=1;d>a;a+=1)for(var h=0;f>h;h+=1)F.append([a,h,1,C])},this.diamond=[[5,0,5,"#"],[0,5,5,"#"],[10,5,5,"#"],[5,10,5,"#"],[5,5,0,"#"],[5,5,10,"#"],[4,1,5,"."],[3,2,5,"."],[2,3,5,"."],[1,4,5,"."],[6,1,5,"."],[7,2,5,"."],[8,3,5,"."],[9,4,5,"."],[4,9,5,"."],[3,8,5,"."],[2,7,5,"."],[1,6,5,"."],[6,9,5,"."],[7,8,5,"."],[8,7,5,"."],[9,6,5,"."],[5,1,4,"."],[5,2,3,"."],[5,3,2,"."],[5,4,1,"."],[5,1,6,"."],[5,2,7,"."],[5,3,8,"."],[5,4,9,"."],[5,9,4,"."],[5,8,3,"."],[5,7,2,"."],[5,6,1,"."],[5,9,6,"."],[5,8,7,"."],[5,7,8,"."],[5,6,9,"."],[4,5,1,"."],[3,5,2,"."],[2,5,3,"."],[1,5,4,"."],[6,5,1,"."],[7,5,2,"."],[8,5,3,"."],[9,5,4,"."],[4,5,9,"."],[3,5,8,"."],[2,5,7,"."],[1,5,6,"."],[6,5,9,"."],[7,5,8,"."],[8,5,7,"."],[9,5,6,"."]],this.palmTree=[[5,10,5,"i"],[5,9,5,"i"],[5,8,5,"i"],[5,7,5,"i"],[5,6,5,"i"],[5,6,5,"i"],[5,5,5,"i"],[5,4,5,"i"],[5,3,5,"i"],[5,2,5,"i"],[5,1,5,"*"],[4,1,4,"*"],[3,1,3,"*"],[2,2,2,"*"],[1,3,1,"*"],[6,1,4,"*"],[7,1,3,"*"],[8,2,2,"*"],[9,3,1,"*"],[6,1,6,"*"],[7,1,7,"*"],[8,2,8,"*"],[9,3,9,"*"],[4,1,6,"*"],[3,1,7,"*"],[2,2,8,"*"],[1,3,9,"*"]],this.sun=[[5,0,5,"#","#FFCC00"],[0,5,5,"#","#FFCC00"],[10,5,5,"#","#FFCC00"],[5,10,5,"#","#FFCC00"],[5,5,0,"#","#FFCC00"],[5,5,10,"#","#FFCC00"],[4,1,5,"-","#FFCC00"],[3,2,5,"-","#FFCC00"],[2,3,5,"-","#FFCC00"],[1,4,5,"-","#FFCC00"],[6,1,5,"-","#FFCC00"],[7,2,5,"-","#FFCC00"],[8,3,5,"-","#FFCC00"],[9,4,5,"-","#FFCC00"],[4,9,5,"-","#FFCC00"],[3,8,5,"-","#FFCC00"],[2,7,5,"-","#FFCC00"],[1,6,5,"-","#FFCC00"],[6,9,5,"-","#FFCC00"],[7,8,5,"-","#FFCC00"],[8,7,5,"-","#FFCC00"],[9,6,5,"-","#FFCC00"],[5,1,4,"-","#FFCC00"],[5,2,3,"-","#FFCC00"],[5,3,2,"-","#FFCC00"],[5,4,1,"-","#FFCC00"],[5,1,6,"-","#FFCC00"],[5,2,7,"-","#FFCC00"],[5,3,8,"-","#FFCC00"],[5,4,9,"-","#FFCC00"],[5,9,4,"-","#FFCC00"],[5,8,3,"-","#FFCC00"],[5,7,2,"-","#FFCC00"],[5,6,1,"-","#FFCC00"],[5,9,6,"-","#FFCC00"],[5,8,7,"-","#FFCC00"],[5,7,8,"-","#FFCC00"],[5,6,9,"-","#FFCC00"],[4,5,1,"-","#FFCC00"],[3,5,2,"-","#FFCC00"],[2,5,3,"-","#FFCC00"],[1,5,4,"-","#FFCC00"],[6,5,1,"-","#FFCC00"],[7,5,2,"-","#FFCC00"],[8,5,3,"-","#FFCC00"],[9,5,4,"-","#FFCC00"],[4,5,9,"-","#FFCC00"],[3,5,8,"-","#FFCC00"],[2,5,7,"-","#FFCC00"],[1,5,6,"-","#FFCC00"],[6,5,9,"-","#FFCC00"],[7,5,8,"-","#FFCC00"],[8,5,7,"-","#FFCC00"],[9,5,6,"-","#FFCC00"],[3,5,3,"-","#FFCC00"],[3,5,8,"-","#FFCC00"],[8,5,3,"-","#FFCC00"],[8,5,8,"-","#FFCC00"]],this.grass=[[5,4,0,". .  .    .","#663300"],[0,3,0,")","#003300"],[4,3,0,"(","#003300"],[0,3,0,"(","#003300"],[3,3,2,")","#003300"]],this.fly=[[2,2,2,"."],[1,2,2,"-"],[3,2,2,"-"]],this.planet=[[0,0,0,".","#ffffff"]],this.planetB=[[0,0,0,".","#FFCC00"]],this.planetC=[[0,0,0,".","#46E3AC"]]}
function Shapes(){}Shapes.prototype.cube=function(o,p){void 0===p&&(p="-");for(var r=[],a=0;6>a;a+=1)for(var e=[],f=0;o>f;f+=1)r.push(e)};
function Canvas(e){this.elem=e,this.ctx=this.elem.getContext("2d"),this.width=e.width,this.height=e.height}function Keyboard(e){var t={keys:{},keyPress:function(e){this.keys[e.keyCode]>0||(this.keys[e.keyCode]=e.timeStamp||(new Date).getTime())},keyRelease:function(e){this.keys[e.keyCode]=0}};return e.addEventListener("keydown",t.keyPress.bind(t)),e.addEventListener("keyup",t.keyRelease.bind(t)),t}function Scroll(e){var t={deltaX:0,deltaY:0};return e.onscroll=function(n){n.preventDefault(),t.deltaX=e.pageXOffset,t.deltaY=e.pageYOffset},t}Envi.prototype.keyCheck=function(){this.keyboard.keys[39]>0&&(this.shiftX+=.025),this.keyboard.keys[37]>0&&(this.shiftX-=.025),this.keyboard.keys[38]>0&&(this.shiftY-=.025),this.keyboard.keys[40]>0&&(this.shiftY+=.025)},Envi.prototype.scrollCheck=function(){0!=this.scroll.deltaY&&(this.shiftY+=.004*this.scroll.deltaY),0!=this.scroll.deltaX&&(this.shiftX+=.004*this.scroll.deltaX)};var utils={};utils.captureMouse=function(e){var t={x:0,y:0};return e.addEventListener("mousemove",function(n){var i,o;n.pageX||n.pageY?(i=n.pageX,o=n.pageY):(i=n.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o=n.clientY+document.body.scrollTop+document.documentElement.scrollTop),i-=e.offsetLeft,o-=e.offsetTop,t.x=i,t.y=o},!1),t},utils.captureTouch=function(e){var t={x:null,y:null,ispressed:!1};return e.addEventListener("touchstart",function(){t.ispressed=!0},!1),e.addEventListener("touchend",function(e){var n,i,o=e.touches[0];o.pageX||o.pageY?(n=o.pageX,i=o.pageY):(n=o.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=o.clientY+document.body.scrollTop+document.documentElement.scrollTop),n-=offsetLeft,i-=offsetTop,t.x=n,t.y=i},!1),t},utils.getAnimationFrame=function(){window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)})},utils.setCanvas=function(e){function t(t){function n(t){e.innerWidth>e.innerHeight?(t.width=Math.min(600,e.innerHeight-60),t.height=Math.min(600,e.innerHeight-60)):(t.width=Math.min(600,e.innerWidth-60),t.height=Math.min(600,e.innerWidth-60))}t.getAttribute("style")||"";e.addEventListener("resize",function(){n(t)},!1),n(t)}e.addEventListener("load",function(){var e=document.getElementsByTagName("canvas")[0];t(e)},!1)},utils.doKeyDown=function(e){switch(e.keyCode){case 38:y-dy>0&&(y-=dy);break;case 40:HEIGHT>y+dy&&(y+=dy);break;case 37:x-dx>0&&(x-=dx);break;case 39:WIDTH>x+dx&&(x+=dx)}};